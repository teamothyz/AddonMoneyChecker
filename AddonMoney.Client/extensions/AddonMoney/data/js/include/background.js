function r(){var t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return!t||101<parseInt(t[2])}function t(){chrome.windows.onRemoved.addListener(function(o){chrome.storage.local.get(["winId"],function(t){var e=t.winId||void 0;o===e?c():chrome.windows.getAll(function(t){1===t.length&&t[0].id===e&&chrome.windows.update(e,{top:0,left:0},function(){chrome.windows.get(e,{populate:!0},function(o){chrome.tabs.create({windowId:e,url:"about:blank"},function(){function e(){++t===o.tabs.length&&setTimeout(function(){c()},100)}var t=0;o.tabs.forEach(function(t){chrome.tabs.remove(t.id,e)})})})})})})}),chrome.windows.onFocusChanged.addListener(function(a){chrome.storage.local.get(["winId","updateInfo","tabActive"],function(t){var e=t.winId||void 0,o=t.updateInfo||o,n=t.tabActive||void 0;r()?e&&chrome.windows.get(e,function(t){chrome.runtime.lastError||"minimized"===t.state&&c()}):a===e?(chrome.windows.update(e,o),n&&chrome.windows.get(n,function(t){"minimized"!==t.state&&chrome.windows.update(n,{focused:!0})})):0<=a&&chrome.storage.local.set({tabActive:a})})}),chrome.windows.onBoundsChanged.addListener(o=>{chrome.storage.local.get(["winId","updateInfo"],function(t){var e=t.winId||void 0,t=t.updateInfo||void 0;o.id==e&&void 0!==e&&(o.height<.9*t.height||o.width<.9*t.width)&&c()})}),chrome.tabs.onUpdated.addListener(function(t,e,o){chrome.storage.local.get(["winId"],function(t){t=t.winId||void 0;o.windowId===t&&e.url&&(/^(http|https)/i.test(o.url)&&chrome.contentSettings.popups.set({primaryPattern:o.url.match(/^https?:\/\/[^\/]+/i)[0]+"/*",setting:"allow"}),chrome.tabs.update(o.id,{muted:!0}),chrome.history.deleteUrl({url:o.url}),chrome.browsingData.removeHistory({since:(new Date).getTime()-1e3,originTypes:{protectedWeb:!0,unprotectedWeb:!0,extension:!0}}))})}),chrome.runtime.onMessage.addListener(function(n,t,a){return"is_ext"==n.message?(chrome.storage.local.set({status:0}),r=t.tab,i=t=>{a(t)},chrome.storage.local.get(["winId","tabId"],function(t){var e=t.winId||void 0,t=t.tabId||void 0;let o="no";t==r.id&&(o="ok"),e==r.windowId&&t!=r.id&&(o="a"),"function"==typeof i&&i(o)}),!0):"connect"==n.message?(a("yes"),!1):"updateWorking"==n.message?((n.state?o:c)(),chrome.storage.local.get(["winId"],function(t){t=t.winId||void 0;a(!!t)}),!0):"stateWorking"==n.message?(chrome.storage.local.get(["winId","titlePage"],function(t){var e=t.winId||void 0,t=t.titlePage||void 0;a({winId:e,titlePage:t})}),!0):"targetAd"==n.message?(e=a,chrome.scripting.executeScript({target:{tabId:t.tab.id,allFrames:!0},files:["data/js/include/subinclude.js"]},function(){s(),e("ok")}),!0):"activeTab"==n.message?(s(),!1):("about:blank"==n.message?chrome.storage.local.get(["tabId"],function(t){var e=t.tabId||void 0,o=e;setTimeout(function(){e&&o==e&&chrome.tabs.update(e,{url:n.url})},n.time||5e3),a("ok")}):d(n,a),!0);var r,i,e}),chrome.notifications.onClicked.addListener(function(t){"Auth"==t&&chrome.tabs.create({url:"https://addon.money/#auth"},t=>{})}),chrome.notifications.onButtonClicked.addListener(function(t){"Auth"==t&&chrome.tabs.create({url:"https://addon.money/#auth"},t=>{})}),chrome.runtime.onStartup.addListener(t=>{n()}),chrome.runtime.setUninstallURL("https://addon.money/uninstall/"),chrome.runtime.onInstalled.addListener(function(t){"update"==t.reason&&chrome.storage.local.get(["winId"],function(t){var e=t.winId||void 0;e?chrome.windows.get(e,{populate:!0},function(t){chrome.runtime.lastError?n():chrome.windows.remove(e,function(){chrome.runtime.lastError,n()})}):n()}),"install"==t.reason&&chrome.tabs.create({url:"https://addon.money/install/"},t=>{})}),chrome.alarms.onAlarm.addListener(t=>{switch(t.name){case"getParam":e(()=>{});break;case"check":chrome.storage.local.get(["titlePage","tabId"],function(t){var e=t.tabId||void 0,o=t.titlePage||"";chrome.storage.local.get(["status"],function(t){t.status||(t.status=0),chrome.storage.local.set({status:++t.status}),3<t.status&&(chrome.tabs.update(e,{url:o}),chrome.storage.local.set({status:0}))})})}})}function o(){chrome.windows.getAll({populate:!0},function(t){1<t.length&&t.forEach(function(e){e.tabs.forEach(function(t){"AddonMoney"===t.title&&chrome.windows.remove(e.id,function(){chrome.runtime.lastError})})})}),chrome.windows.getLastFocused(function(e){chrome.runtime.lastError,chrome.storage.local.get(["winId"],function(t){t=t.winId||void 0;e&&e.id&&e.id!=t&&chrome.storage.local.set({tabActive:e.id})})}),chrome.storage.local.set({status:0}),chrome.storage.local.get(["titlePage","updateInfo"],t=>{var e=t.titlePage||"",o=t.updateInfo||void 0;chrome.windows.create({width:o.width,height:o.height,url:e,focused:!1,type:"normal"},function(t){var e=t.id,t=t.tabs[0].id;chrome.storage.local.set({winId:e,tabId:t}),chrome.tabs.update(t,{muted:!0},function(t){}),chrome.windows.update(e,o),chrome.alarms.create("check",{periodInMinutes:1}),chrome.action.setBadgeText({text:" ON "}),chrome.action.setBadgeBackgroundColor({color:"#0BB783"})})})}function c(){chrome.alarms.clear("check"),chrome.action.setBadgeText({text:" OFF "}),chrome.action.setBadgeBackgroundColor({color:"#252437"}),chrome.storage.local.get(["winId"],function(t){t=t.winId||void 0;try{chrome.windows.remove(t,function(){chrome.runtime.lastError})}catch(t){}chrome.storage.local.set({winId:null,tabId:null,tabActive:null})})}function s(){chrome.storage.local.get(["tabId"],function(t){var e=t.tabId||void 0;setTimeout(function(){chrome.tabs.update(e,{active:!0})},150)})}function d(t,e){var o,n=new FormData;for(o in t.data)Array.isArray(t.data[o])?t.data[o].forEach(function(t){n.append(o+"[]",t)}):n.append(o,t.data[o]);n.append("ver",chrome.runtime.getManifest().version),fetch("https://addon.money/window/"+t.path,{method:"POST",body:n}).then(function(t){return t.ok?t.json():{error:"yes",message:"error connect"}}).then(function(t){"noAuth"==t.message&&c(),e(t)}).catch(function(t){e({error:"yes",message:"error connect"})})}function e(o){chrome.storage.local.get(["titleData","titlePage"],t=>{var e=t.titlePage||"";(t.titleData||0)+86400<(Date.now()/1e3|0)||""==e?d({path:"param.php",data:{}},function(t){t.title?chrome.storage.local.set({titlePage:t.title,titleData:Date.now()/1e3|0},function(){"function"==typeof o&&o(!0)}):(chrome.alarms.create("getParam",{delayInMinutes:1}),o(!1))}):"function"==typeof o&&o(!0)})}function n(){e(t=>{t&&chrome.storage.local.get(["state"],function(t){t.state=void 0===t.state||t.state,t.state&&o()})})}({init:function(){t(),e(()=>{}),chrome.storage.local.get(["winId"],function(t){t=t.winId||void 0;t?chrome.windows.get(t,{populate:!0},function(t){chrome.runtime.lastError&&c()}):(chrome.action.setBadgeText({text:" OFF "}),chrome.action.setBadgeBackgroundColor({color:"#252437"}))}),chrome.system.display.getInfo(t=>{let e={top:0};if(t.length){for(var o in t)if(e.width=t[o].workArea.width,e.height=t[o].workArea.height,t[o].isPrimary)break;r()&&(e.left=e.width/2-2)}chrome.storage.local.set({updateInfo:e},()=>{})})}}).init();